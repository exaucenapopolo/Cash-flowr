<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MULAFLOWR - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    /* Logique de chargement simplifiée */
    body {
      background: linear-gradient(135deg, #d5e8d9 0%, #c5dfe6 100%);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      /* La visibilité est gérée par JS pour éviter le flash de contenu */
      visibility: hidden; 
      opacity: 0;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    body.loaded {
      visibility: visible;
      opacity: 1;
    }

    :root {
      --primary-color: #3a8ee6;
      --primary-light: #4da6ff;
      --primary-dark: #2c75c9;
      --secondary-color: #4c566a;
      --accent-color: #5e81ac;
      --background-light: #f5f7fb;
      --background-dark: #e5e9f0;
      --card-bg: #ffffff;
      --text-color: #2e3440;
      --text-light: #4c566a;
      --success-color: #4CD964;
      --warning-color: #FF9500;
      --danger-color: #FF3B30;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
      --username-color: #FFD700;
    }

    .dark-mode {
      --primary-color: #5e81ac;
      --primary-light: #81a1c1;
      --primary-dark: #4c566a;
      --secondary-color: #d8dee9;
      --accent-color: #88c0d0;
      --background-light: #2e3440;
      --background-dark: #3b4252;
      --card-bg: #434c5e;
      --text-color: #eceff4;
      --text-light: #d8dee9;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      --username-color: #FFA500;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: var(--transition);
    }

    /* Loader */
    .loader-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #d5e8d9 0%, #c5dfe6 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .dark-mode .loader-container {
        background: #2e3440;
    }

    .loader-container.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loader {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: conic-gradient(#0000 10%, var(--primary-color));
      -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 8px), #000 0);
      animation: spin 1s infinite linear;
    }

    @keyframes spin {
      to {
        transform: rotate(1turn);
      }
    }

    /* Header */
    .header {
      background-color: var(--card-bg);
      box-shadow: var(--shadow);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--primary-color);
      font-family: 'Montserrat', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .language-selector, .theme-toggle {
      background-color: var(--primary-light);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    .theme-toggle {
      background-color: var(--secondary-color);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 5px;
      border-radius: 50px;
      transition: background-color 0.3s ease;
    }
    .user-profile:hover {
        background-color: var(--background-dark);
    }

    .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background-color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      border: 2px solid var(--primary-light);
    }
    
    /* Main layout */
    .main-container {
      display: flex;
      flex: 1;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background-color: var(--card-bg);
      box-shadow: var(--shadow);
      height: calc(100vh - 80px); /* Hauteur de l'en-tête */
      position: sticky;
      top: 80px; /* Hauteur de l'en-tête */
      padding: 25px 0;
      overflow-y: auto;
    }

    .welcome-section {
      padding: 0 25px 25px;
      border-bottom: 1px solid var(--background-dark);
      margin-bottom: 20px;
    }

    .welcome-text {
      color: var(--text-light);
      font-size: 0.9rem;
      margin-bottom: 5px;
    }

    .username {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--primary-color);
    }

    .menu-category {
      padding: 15px 25px 5px;
      font-size: 0.85rem;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    .menu-item {
      padding: 12px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between; /* Pour aligner le badge */
      color: var(--text-color);
      text-decoration: none;
      font-weight: 500;
      border-left: 4px solid transparent;
      position: relative;
    }

    .menu-item-content {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-item:hover, .menu-item.active {
      background-color: var(--background-dark);
      border-left-color: var(--primary-color);
      color: var(--primary-color);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .menu-item:hover i {
      animation: dance 0.5s ease infinite;
    }

    @keyframes dance {
      0%, 100% { transform: translateY(0) rotate(0); }
      25% { transform: translateY(-3px) rotate(-5deg); }
      50% { transform: translateY(0) rotate(0); }
      75% { transform: translateY(-3px) rotate(5deg); }
    }

    /* AMÉLIORATION : Case à cocher stylisée avec animation */
    .checkbox-badge {
      width: 20px;
      height: 20px;
      border: 2px solid var(--text-light);
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    .checkbox-badge.checked {
      border-color: var(--success-color);
      background-color: var(--success-color);
    }
    
    .checkbox-badge.banned {
      border-color: var(--danger-color);
      background-color: var(--danger-color);
    }

    /* Le crochet (check) */
    .checkbox-badge.checked::after {
      content: '';
      position: absolute;
      width: 5px;
      height: 10px;
      border: solid white;
      border-width: 0 3px 3px 0;
      transform: rotate(45deg);
      animation: draw-check 0.3s ease forwards;
    }
    
    /* La croix (ban) */
    .checkbox-badge.banned::before,
    .checkbox-badge.banned::after {
        content: '';
        position: absolute;
        width: 12px;
        height: 2px;
        background-color: white;
        animation: draw-check 0.3s ease forwards;
    }
    .checkbox-badge.banned::before {
        transform: rotate(45deg);
    }
    .checkbox-badge.banned::after {
        transform: rotate(-45deg);
    }


    @keyframes draw-check {
      0% {
        transform: scale(0) rotate(45deg);
      }
      100% {
        transform: scale(1) rotate(45deg);
      }
    }
    .banned @keyframes draw-check {
        0% { transform: scale(0) rotate(45deg); }
        100% { transform: scale(1) rotate(45deg); }
    }


    /* Content area */
    .content {
      flex: 1;
      padding: 30px;
    }

    /* ... (Le reste de votre CSS reste inchangé, il est déjà excellent !) ... */
    /* ... (toutes les classes de .page-title à .notification) ... */
     .page-title {
      font-size: 1.5rem;
      margin-bottom: 25px;
      color: var(--secondary-color);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-title i {
      color: var(--primary-color);
    }

    /* Banner - MODIFIÉ avec nom d'utilisateur et style spécial */
    .banner {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .banner::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    .banner-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .banner-text {
      font-size: 0.9rem;
      margin-bottom: 15px;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .username-display {
      font-family: 'Dancing Script', cursive;
      font-size: 1.5rem;
      color: var(--username-color);
      font-weight: 700;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
      margin: 5px 0;
    }

    .banner-link {
      display: inline-block;
      background-color: white;
      color: var(--primary-color);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: 600;
      text-decoration: none;
      font-size: 0.9rem;
      position: relative;
      z-index: 1;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .banner-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .small-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .small-stat-card {
      background: linear-gradient(135deg, #ff6b6b 0%, #c62828 100%);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      height: 120px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .small-stat-card:nth-child(2) {
      background: linear-gradient(135deg, #4cd964 0%, #2e7d32 100%);
    }

    .small-stat-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .small-stat-title {
      color: white;
      font-size: 1rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 2;
    }

    .small-stat-value {
      font-size: 1.6rem;
      font-weight: 700;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
      z-index: 2;
    }

    .arrow-icon {
      font-size: 1.5rem;
    }

    .small-stat-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .small-stat-card:hover::after {
      opacity: 1;
    }

    .large-stats {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .large-stat-card {
      background: linear-gradient(135deg, #a2d2ff 0%, #5c9ce6 100%);
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      color: white;
      min-height: 150px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .large-stat-card::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 30%; /* Niveau d'eau à 30% */
      background: linear-gradient(to top, rgba(58, 142, 230, 0.7), rgba(58, 142, 230, 0.3));
      z-index: 1;
      animation: waterWave 6s ease-in-out infinite;
      border-radius: 50% 50% 0 0;
    }

    @keyframes waterWave {
      0%, 100% {
        transform: translateY(0) scale(1, 1);
        opacity: 0.7;
      }
      50% {
        transform: translateY(-5px) scale(1.05, 0.95);
        opacity: 0.9;
      }
    }

    .large-stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }

    .large-stat-title {
      font-size: 0.9rem;
      margin-bottom: 10px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 2;
    }

    .large-stat-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 5px;
      z-index: 2;
    }

    .large-stat-icon {
      font-size: 2rem;
      opacity: 0.7;
      z-index: 2;
    }
    
    .medium-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .medium-stat-card {
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      min-height: 130px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .medium-stat-card::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 25%; /* Niveau d'eau à 25% */
      z-index: 1;
      animation: waterWave 5s ease-in-out infinite;
      border-radius: 50% 50% 0 0;
    }

    .medium-stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }

    .medium-stat-card:nth-child(1) { background: linear-gradient(135deg, #ffc7a2 0%, #ff9a5c 100%); }
    .medium-stat-card:nth-child(1)::before { background: linear-gradient(to top, rgba(255, 156, 92, 0.7), rgba(255, 156, 92, 0.3)); }
    .medium-stat-card:nth-child(2) { background: linear-gradient(135deg, #c2a2ff 0%, #8c5ce7 100%); }
    .medium-stat-card:nth-child(2)::before { background: linear-gradient(to top, rgba(140, 92, 231, 0.7), rgba(140, 92, 231, 0.3)); }
    .medium-stat-card:nth-child(3) { background: linear-gradient(135deg, #a2ffc7 0%, #5ce78c 100%); }
    .medium-stat-card:nth-child(3)::before { background: linear-gradient(to top, rgba(92, 231, 140, 0.7), rgba(92, 231, 140, 0.3)); }

    #solde-card::before { height: 30%; animation-duration: 6s; }
    #retire-card::before { height: 25%; animation-duration: 7s; }
    #parrainage-card::before { height: 35%; animation-duration: 5s; }
    #bonus-agent-card::before { height: 30%; animation-duration: 8s; }

    .medium-stat-title {
      color: white;
      font-size: 0.9rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 2;
    }
    .medium-stat-value {
      font-size: 1.6rem;
      font-weight: 700;
      color: white;
      z-index: 2;
    }
    .medium-stat-icon {
      font-size: 2rem;
      opacity: 0.7;
      z-index: 2;
    }

    .gain-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .gain-stat-card {
      border-radius: 10px;
      padding: 15px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      height: 90px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      animation: bounceTrivia 4s infinite;
    }
    .gain-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: 1;
    }

    @keyframes bounceTrivia {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .gain-stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    .gain-stat-card:hover::before { opacity: 1; }
    .gain-stat-card:nth-child(1) { background: linear-gradient(135deg, #d4ffd4 0%, #a0f0a0 100%); }
    .gain-stat-card:nth-child(2) { background: linear-gradient(135deg, #ffd4f0 0%, #f0a0d4 100%); }
    .gain-stat-card:nth-child(3) { background: linear-gradient(135deg, #d4f0ff 0%, #a0d4f0 100%); }
    .gain-stat-card:nth-child(4) { background: linear-gradient(135deg, #fff0d4 0%, #f0d4a0 100%); }
    .gain-stat-card:nth-child(5) { background: linear-gradient(135deg, #e6d4ff 0%, #c8a0f0 100%); }
    .gain-stat-card:nth-child(6) { background: linear-gradient(135deg, #d4fff0 0%, #a0f0d4 100%); }
    .gain-stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      z-index: 2;
    }
    .gain-stat-title {
      color: var(--text-light);
      font-size: 0.75rem;
      font-weight: 500;
      z-index: 2;
    }
    .gain-stat-icon {
      width: 25px;
      height: 25px;
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.3);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      z-index: 2;
      transition: transform 0.3s ease;
    }
    .gain-stat-card:hover .gain-stat-icon { transform: scale(1.2); }
    .gain-stat-value {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-color);
      z-index: 2;
    }
    
    .fidelity-section, .referral-section, .user-info-section, .task-calendar {
      background: linear-gradient(135deg, #e6fffd 0%, #b2fff8 100%);
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }
    .referral-section { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); }
    .user-info-section { background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); }
    .task-calendar { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); }

    .fidelity-section::before, .referral-section::before, .user-info-section::before, .task-calendar::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--secondary-color);
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .fidelity-key, .link-box {
      display: flex;
      align-items: center;
      gap: 15px;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      position: relative;
      z-index: 1;
      transition: transform 0.3s ease;
    }
    .fidelity-key:hover, .link-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .key-icon {
      font-size: 1.5rem;
      color: var(--primary-color);
      animation: bounceKey 2s infinite;
    }
    @keyframes bounceKey {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .key-text {
      flex: 1;
      font-family: monospace;
      font-size: 1.1rem;
      letter-spacing: 1px;
    }
    .key-buttons {
      display: flex;
      gap: 10px;
    }
    .copy-key-btn, .send-key-btn, .copy-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .copy-key-btn:hover, .send-key-btn:hover, .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .send-key-btn { background-color: #25D366; }

    .referral-content { display: flex; gap: 30px; flex-wrap: wrap; }
    .referral-link-container { flex: 1; min-width: 300px; }
    .link-text {
      font-size: 0.9rem;
      color: var(--text-light);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      flex: 1;
      margin-right: 15px;
    }

    .social-share { display: flex; gap: 10px; margin-top: 15px; }
    .social-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
      z-index: 1;
      animation: pulseSocial 2s infinite;
    }
    @keyframes pulseSocial {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .social-btn:hover { animation: none; transform: scale(1.15); }
    .whatsapp { background-color: #25D366; }
    .facebook { background-color: #3b5998; }
    .twitter { background-color: #1DA1F2; }
    .telegram { background-color: #0088cc; }

    .user-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    .info-item {
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 1;
      padding: 15px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      transition: transform 0.3s ease;
    }
    .info-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .info-label { font-size: 0.85rem; color: var(--text-light); margin-bottom: 5px; }
    .info-value { font-size: 1rem; font-weight: 500; color: var(--text-color); }
    
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: relative; z-index: 1; }
    .calendar-month { font-weight: 600; color: var(--text-color); }
    .calendar-nav { display: flex; gap: 10px; }
    .nav-btn {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background-color: var(--primary-light);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .nav-btn:hover { transform: scale(1.1); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
    .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 15px; }
    .day-header { text-align: center; padding: 10px; font-weight: 600; color: var(--text-light); font-size: 0.9rem; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .calendar-date {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      background-color: rgba(255, 255, 255, 0.5);
      transition: all 0.2s ease;
    }
    .calendar-date:hover { background-color: rgba(0, 0, 0, 0.05); transform: scale(1.05); }
    .calendar-date.active { background-color: var(--primary-color); color: white; transform: scale(1.05); animation: pulse 2s infinite; }
    .calendar-date.has-task::after {
      content: "";
      position: absolute;
      bottom: 5px;
      width: 6px;
      height: 6px;
      background-color: var(--success-color);
      border-radius: 50%;
    }

    .task-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .task-table th, .task-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(0,0,0,0.1); }
    .dark-mode .task-table th, .dark-mode .task-table td { border-bottom: 1px solid rgba(255,255,255,0.1); }
    .task-table th { background-color: rgba(0, 0, 0, 0.05); font-weight: 600; color: var(--text-light); }
    .task-table tr { transition: background-color 0.2s ease, transform 0.2s ease; }
    .task-table tr:hover { background-color: rgba(0, 0, 0, 0.03); transform: scale(1.01); }
    .task-status { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem; color: white; }
    .task-status.active { background-color: var(--success-color); }
    .task-status.completed { background-color: var(--primary-color); }
    .task-status.pending { background-color: var(--warning-color); }

    .footer { background-color: var(--card-bg); padding: 20px 30px; text-align: center; box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08); margin-top: auto; }
    .footer-content { display: flex; flex-direction: column; gap: 10px; }
    .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
    .footer-link { color: var(--primary-color); text-decoration: none; font-weight: 500; transition: color 0.2s ease; }
    .footer-link:hover { text-decoration: underline; color: var(--primary-dark); }
    .footer-text { color: var(--text-light); font-size: 0.9rem; }
    
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .pulse { animation: pulse 2s infinite; }

    .hamburger-menu { display: none; background: none; border: none; font-size: 1.5rem; color: var(--secondary-color); cursor: pointer; }
    .overlay { display: none; position: fixed; top: 80px; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 98; }

    @media (max-width: 992px) {
      .sidebar { width: 230px; }
      .medium-stats { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .main-container { flex-direction: column; }
      .hamburger-menu { display: block; }
      .sidebar {
        width: 70%; max-width: 280px; height: 100vh;
        position: fixed; top: 0; left: -100%; z-index: 101;
        box-shadow: 5px 0 15px rgba(0,0,0,0.2);
        transition: left 0.3s ease-in-out;
        padding-top: 80px;
      }
      .sidebar.active { left: 0; }
      .overlay.active { display: block; }
      .header { padding: 15px; }
      .logo { font-size: 1.5rem; }
      .content { padding: 20px; }
      .medium-stats, .gain-stats { grid-template-columns: 1fr; }
      .key-buttons { flex-direction: column; }
      .footer-links { flex-direction: column; gap: 10px; }
    }

    /* Notifications */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }
    .notification {
      padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex; align-items: center; gap: 10px; max-width: 350px;
      animation: slideIn 0.3s ease forwards;
      position: relative; overflow: hidden; color: white; pointer-events: auto;
    }
    .notification.success { background: linear-gradient(135deg, var(--success-color) 0%, #2AB32A 100%); }
    .notification.error { background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%); }
    .notification.info { background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%); }
    @keyframes slideIn {
      from { transform: translateX(110%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>

  <div class="loader-container" id="loader">
    <div class="loader"></div>
  </div>

  <div class="notification-container" id="notificationContainer"></div>

  <header class="header">
    <button class="hamburger-menu" id="hamburgerMenu">
      <i class="fas fa-bars"></i>
    </button>
    <div class="logo">MULAFLOWR</div>
    <div class="header-controls">
      <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
        <span>Mode nuit</span>
      </button>
      <div class="user-profile" id="userProfile" title="Se déconnecter">
        <div class="avatar" id="userAvatar">U</div>
      </div>
    </div>
  </header>
  
  <div class="overlay" id="overlay"></div>

  <div class="main-container">
    <aside class="sidebar" id="sidebar">
      <div class="welcome-section">
        <div class="welcome-text">Dashboard >> MULAFLOWR</div>
        <div class="username" id="sidebarUsername">Utilisateur</div>
      </div>
      
      <div class="menu-category">PRINCIPAL</div>
      <a href="dashboard.html" class="menu-item active">
        <div class="menu-item-content"><i class="fas fa-home"></i><span>Tableau de bord</span></div>
        <span class="checkbox-badge checked"></span>
      </a>
      <a href="depot.html" class="menu-item">
        <div class="menu-item-content"><i class="fas fa-wallet"></i><span>Dépôt 💵</span></div>
        <span class="checkbox-badge"></span>
      </a>
      <a href="bonus_bienvenue.html" class="menu-item">
        <div class="menu-item-content"><i class="fas fa-gift"></i><span>Bonus de bienvenue</span></div>
        <span class="checkbox-badge banned"></span>
      </a>
      
      <div class="menu-category">COMPTES</div>
      <a href="retrait.html" class="menu-item">
        <div class="menu-item-content"><i class="fas fa-money-bill-wave"></i><span>Retrait</span></div>
        <span class="checkbox-badge"></span>
      </a>
      <a href="equipe.html" class="menu-item">
        <div class="menu-item-content"><i class="fas fa-users"></i><span>Équipe</span></div>
        <span class="checkbox-badge banned"></span>
      </a>

      </aside>

    <main class="content">
      <h1 class="page-title"><i class="fas fa-home"></i><span>Dashboard >> MULAFLOWR</span></h1>
      
      <div class="banner" id="welcomeBanner">
        <div class="banner-title">Bienvenue sur MULAFLOWR</div>
        <div class="username-display" id="welcomeUsername">Utilisateur</div>
        <div class="banner-text">Débloquez plus de 10 outils numériques avec MULAFLOWR, conçus pour VOUS !</div>
        <a href="#" class="banner-link">Obtenir l'application Android</a>
      </div>
      
       <div class="small-stats">
        <div class="small-stat-card" id="depense-card">
          <div class="small-stat-title"><i class="fas fa-arrow-down arrow-icon"></i>Dépense:</div>
          <div class="small-stat-value">XAF 0</div>
        </div>
        <div class="small-stat-card" id="profit-card">
          <div class="small-stat-title"><i class="fas fa-arrow-up arrow-icon"></i>Profit:</div>
          <div class="small-stat-value">XAF 0</div>
        </div>
      </div>
      
      <div class="large-stats">
        <div class="large-stat-card" id="solde-card">
          <div class="large-stat-title"><i class="fas fa-piggy-bank large-stat-icon"></i>SOLDE</div>
          <div class="large-stat-value">XAF 0</div>
        </div>
      </div>
      
      <div class="medium-stats">
        <div class="medium-stat-card" id="retire-card">
          <div class="medium-stat-title"><i class="fas fa-download medium-stat-icon"></i>Retiré</div>
          <div class="medium-stat-value">XAF 0</div>
        </div>
        <div class="medium-stat-card" id="parrainage-card">
          <div class="medium-stat-title"><i class="fas fa-users medium-stat-icon"></i>Gains de parrainage</div>
          <div class="medium-stat-value">XAF 0</div>
        </div>
        <div class="medium-stat-card" id="bonus-agent-card">
          <div class="medium-stat-title"><i class="fas fa-gift medium-stat-icon"></i>Bonus d'agent</div>
          <div class="medium-stat-value">XAF 0</div>
        </div>
      </div>

      <div class="fidelity-section">
        <h2 class="section-title">CLÉ DE FIDÉLITÉ</h2>
        <div class="fidelity-key">
          <i class="fas fa-key key-icon"></i>
          <div class="key-text" id="fidelityKey">Génération...</div>
          <div class="key-buttons">
            <button class="copy-key-btn" id="copyKeyBtn"><i class="fas fa-copy"></i><span>Copier</span></button>
            <button class="send-key-btn" id="sendKeyBtn"><i class="fab fa-whatsapp"></i><span>Envoyer</span></button>
          </div>
        </div>
      </div>

      <div class="gain-stats">
        </div>
      
      <div class="referral-section">
        <h2 class="section-title">LIEN DE PARRAINAGE</h2>
        <div class="referral-content">
          <div class="referral-link-container">
            <div class="link-box">
              <div class="link-text" id="referralLink">Génération...</div>
              <button class="copy-btn" id="copyLinkBtn"><i class="fas fa-copy"></i><span>Copier</span></button>
            </div>
            <div class="social-share">
              <div class="social-btn whatsapp" id="shareWhatsApp"><i class="fab fa-whatsapp"></i></div>
              <div class="social-btn facebook" id="shareFacebook"><i class="fab fa-facebook-f"></i></div>
              <div class="social-btn twitter" id="shareTwitter"><i class="fab fa-twitter"></i></div>
              <div class="social-btn telegram" id="shareTelegram"><i class="fab fa-telegram-plane"></i></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="user-info-section">
        <h2 class="section-title">INFORMATIONS UTILISATEUR</h2>
        <div class="user-info-grid">
          <div class="info-item"><div class="info-label">Nom d'utilisateur</div><div class="info-value" id="info-username">Chargement...</div></div>
          <div class="info-item"><div class="info-label">Email</div><div class="info-value" id="info-email">Chargement...</div></div>
          <div class="info-item"><div class="info-label">Téléphone</div><div class="info-value" id="info-phone">Chargement...</div></div>
          <div class="info-item"><div class="info-label">Pays</div><div class="info-value" id="info-country">Chargement...</div></div>
          <div class="info-item"><div class="info-label">Parrain</div><div class="info-value" id="info-parrain">Chargement...</div></div>
          <div class="info-item"><div class="info-label">Parrainage actif</div><div class="info-value" id="info-parrainage">0 personnes</div></div>
        </div>
      </div>
      
      <div class="task-calendar">
        <h2 class="section-title">CALENDRIER DES TÂCHES</h2>
        <div class="calendar-header">
          <div class="calendar-month">Septembre 2025</div>
          <div class="calendar-nav">
            <div class="nav-btn" id="prevMonth"><i class="fas fa-chevron-left"></i></div>
            <div class="nav-btn" id="nextMonth"><i class="fas fa-chevron-right"></i></div>
          </div>
        </div>
        <div class="calendar-days">
          <div class="day-header">Lun</div><div class="day-header">Mar</div><div class="day-header">Mer</div>
          <div class="day-header">Jeu</div><div class="day-header">Ven</div><div class="day-header">Sam</div><div class="day-header">Dim</div>
        </div>
        <div class="calendar-grid"></div>
        <table class="task-table">
          <thead><tr><th>ID</th><th>Tâche</th><th>Statut</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>Youtube</td><td><span class="task-status active">Active</span></td></tr>
            <tr><td>2</td><td>Trivia</td><td><span class="task-status completed">Terminée</span></td></tr>
            <tr><td>3</td><td>Tiktok</td><td><span class="task-status pending">En attente</span></td></tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="#" class="footer-link">Pro Tech Management</a>
        <a href="#" class="footer-link">Site propulsé par Social Boost Horizon</a>
      </div>
      <div class="footer-text">© 2025 MULAFLOWR. Tous droits réservés.</div>
    </div>
  </footer>

  <script>
    // ========= CONFIG FIREBASE (NE PAS CHANGER) =========
    const firebaseConfig = {
      apiKey: "VOTRE_API_KEY", // Remplacez par votre vraie clé
      authDomain: "cash-flowr.firebaseapp.com",
      projectId: "cash-flowr",
      storageBucket: "cash-flowr.appspot.com",
      messagingSenderId: "1091928501310",
      appId: "1:1091928501310:web:4f4de306cde36f378ff56f",
      measurementId: "G-5SF6VDLZCB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ========= SÉLECTION DES ÉLÉMENTS DU DOM =========
    const loader = document.getElementById('loader');
    const userProfile = document.getElementById('userProfile');
    const themeToggle = document.getElementById('themeToggle');
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');

    // ========= GESTIONNAIRES D'ÉVÉNEMENTS =========

    // Menu hamburger pour mobile
    hamburgerMenu.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    });
    overlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
    });

    // Changement de thème
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      themeToggle.innerHTML = isDarkMode 
        ? '<i class="fas fa-sun"></i><span>Mode jour</span>' 
        : '<i class="fas fa-moon"></i><span>Mode nuit</span>';
      // Sauvegarder la préférence du thème
      if (auth.currentUser) {
        db.collection('users').doc(auth.currentUser.uid).set({ theme: isDarkMode ? 'dark' : 'light' }, { merge: true });
      }
    });

    // Déconnexion
    userProfile.addEventListener('click', () => {
        showNotification('info', 'Déconnexion', 'Vous allez être déconnecté...');
        setTimeout(() => {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            });
        }, 1500);
    });

    // ========= FONCTIONS UTILITAIRES =========

    /** Affiche une notification à l'écran */
    function showNotification(type, title, message, duration = 4000) {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      const icon = type === 'success' ? 'fa-check-circle' : (type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
      notification.innerHTML = `
        <i class="fas ${icon}" style="font-size: 1.5rem;"></i>
        <div>
          <strong style="display: block; margin-bottom: 5px;">${title}</strong>
          <span>${message}</span>
        </div>`;
      container.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse forwards';
        setTimeout(() => { if (container.contains(notification)) container.removeChild(notification); }, 300);
      }, duration);
    }
    
    /** Met à jour l'UI avec les données de l'utilisateur */
    function updateUI(user, userData) {
        const displayName = userData.displayName || user.displayName || user.email.split('@')[0];

        // Mettre à jour les informations générales
        document.getElementById('sidebarUsername').textContent = displayName;
        document.getElementById('welcomeUsername').textContent = displayName;
        document.getElementById('userAvatar').textContent = displayName.charAt(0).toUpperCase();

        // Mettre à jour les statistiques
        const formatCurrency = (value) => `XAF ${Number(value || 0).toLocaleString('fr-FR')}`;
        document.querySelector('#depense-card .small-stat-value').textContent = formatCurrency(userData.depense);
        document.querySelector('#profit-card .small-stat-value').textContent = formatCurrency(userData.profit);
        document.querySelector('#solde-card .large-stat-value').textContent = formatCurrency(userData.solde);
        // ... ajoutez les autres statistiques ici

        // Mettre à jour les informations de l'utilisateur
        document.getElementById('info-username').textContent = displayName;
        document.getElementById('info-email').textContent = user.email;
        document.getElementById('info-phone').textContent = userData.phoneNumber || 'Non renseigné';
        document.getElementById('info-country').textContent = userData.country || 'Non renseigné';
        document.getElementById('info-parrain').textContent = userData.referrer || 'Aucun';
        document.getElementById('info-parrainage').textContent = `${userData.activeReferrals || 0} personnes`;
        
        // Mettre à jour les liens et clés
        const uidPart1 = user.uid.substring(0, 4).toUpperCase();
        const uidPart2 = user.uid.substring(4, 8).toUpperCase();
        document.getElementById('fidelityKey').textContent = `MULA-USER-${uidPart1}-${uidPart2}`;
        document.getElementById('referralLink').textContent = `mulaflowr.com/?ref=${user.uid.substring(0, 10)}`;

        // Appliquer le thème sauvegardé
        const isDarkMode = userData.theme === 'dark';
        document.body.classList.toggle('dark-mode', isDarkMode);
        themeToggle.innerHTML = isDarkMode 
            ? '<i class="fas fa-sun"></i><span>Mode jour</span>' 
            : '<i class="fas fa-moon"></i><span>Mode nuit</span>';
    }


    // ========= LOGIQUE PRINCIPALE D'AUTHENTIFICATION =========

    auth.onAuthStateChanged(async (user) => {
      if (user) {
        try {
          // 1. Récupérer les données de l'utilisateur depuis Firestore
          const userDoc = await db.collection('users').doc(user.uid).get();

          if (!userDoc.exists) {
            throw new Error("Profil utilisateur non trouvé dans la base de données.");
          }
          
          const userData = userDoc.data();
          
          // 2. VÉRIFICATION CRUCIALE : L'utilisateur a-t-il payé ?
          // (Adaptez 'isPaid' au nom réel du champ dans votre base de données)
          if (!userData.isPaid) {
            showNotification('info', 'Action requise', 'Veuillez finaliser votre inscription pour continuer.');
            setTimeout(() => { window.location.href = 'paiement.html'; }, 2500);
            return; // Arrête l'exécution pour cet utilisateur
          }

          // 3. Mettre à jour toute l'interface utilisateur
          updateUI(user, userData);
          
          // 4. Afficher la page et masquer le loader
          document.body.classList.add('loaded');
          loader.classList.add('hidden');
          
          showNotification('success', 'Bienvenue !', `Content de vous revoir, ${userData.displayName || user.email.split('@')[0]} !`);

        } catch (error) {
          // **CORRECTION DU BUG :** On gère l'erreur sans déconnecter l'utilisateur
          console.error("Erreur critique lors du chargement des données :", error);
          showNotification('error', 'Erreur Critique', "Impossible de charger vos données. Contactez le support.");
          // On affiche quand même la page pour que l'utilisateur ne soit pas bloqué
          document.body.classList.add('loaded');
          loader.classList.add('hidden');
        }
      } else {
        // Si aucun utilisateur n'est connecté, rediriger vers la page de connexion
        window.location.href = 'login.html';
      }
    });

  </script>
</body>
</html>
