<!DOCTYPE html>
<html lang="fr" style="visibility: hidden;">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MULAFLOWR - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <style>
    :root{
      --primary-color:#3a8ee6;
      --primary-light:#4da6ff;
      --primary-dark:#2c75c9;
      --card-bg:#ffffff;
      --text-color:#2e3440;
      --text-light:#4c566a;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --transition: all 0.3s ease;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;transition:var(--transition);}
    html,body{height:100%;}
    body{background:linear-gradient(135deg,#d5e8d9 0%,#c5dfe6 100%);color:var(--text-color);min-height:100vh;display:flex;flex-direction:column;}

    /* Loader */
    .loader-container{
      position:fixed;inset:0;
      background:linear-gradient(135deg,#d5e8d9 0%,#c5dfe6 100%);
      display:flex;align-items:center;justify-content:center;z-index:99999;
      transition:opacity .45s ease,visibility .45s ease;
    }
    .loader-container.hidden{opacity:0;visibility:hidden;pointer-events:none;}
    .loader{
      width:64px;height:64px;border-radius:50%;
      background:conic-gradient(#0000 12%, var(--primary-color));
      -webkit-mask: radial-gradient(farthest-side,#0000 calc(100% - 8px),#000 0);
      animation:spin 1s linear infinite; box-shadow:0 8px 30px rgba(0,0,0,0.12);
    }
    @keyframes spin{to{transform:rotate(1turn);} }

    /* Header */
    .header{background:var(--card-bg);box-shadow:var(--shadow);padding:15px 30px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;}
    .logo{font-weight:800;color:var(--primary-color);font-family:'Montserrat',sans-serif;}
    .header-controls{display:flex;align-items:center;gap:12px;}
    .language-selector,.theme-toggle{border-radius:20px;padding:8px 12px;border:none;cursor:pointer;display:flex;align-items:center;gap:8px;}
    .theme-toggle{background:var(--primary-light);color:#fff;}
    .avatar{width:45px;height:45px;border-radius:50%;background:var(--primary-color);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;border:2px solid var(--primary-light);}

    .main-container{display:flex;flex:1;}
    .sidebar{width:280px;background:var(--card-bg);box-shadow:var(--shadow);height:calc(100vh - 80px);position:sticky;top:80px;padding:25px 0;overflow-y:auto;}
    .welcome-section{padding:0 25px 25px;border-bottom:1px solid rgba(0,0,0,0.08);margin-bottom:20px;}
    .username{color:var(--primary-color);font-weight:600;}

    .menu-item{padding:12px 25px 12px 35px;display:flex;align-items:center;gap:12px;color:var(--text-color);text-decoration:none;position:relative;}
    .menu-item.active,.menu-item:hover{background:rgba(0,0,0,0.05);border-left:4px solid var(--primary-color);color:var(--primary-color);}
    .menu-badge{position:absolute;right:25px;background:var(--primary-color);color:#fff;padding:2px 8px;border-radius:10px;font-size:0.75rem;}

    .content{flex:1;padding:30px;}
    .page-title{font-size:1.4rem;margin-bottom:20px;color:var(--text-light);display:flex;gap:10px;align-items:center;}

    .banner{background:linear-gradient(135deg,var(--primary-light),var(--primary-dark));color:#fff;padding:18px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:22px;position:relative;overflow:hidden;}
    .banner::before{content:'';position:absolute;inset:-40% auto auto -40%;width:200%;height:200%;background:linear-gradient(to right,transparent,rgba(255,255,255,0.14),transparent);transform:rotate(45deg);animation:shimmer 3s linear infinite;}
    @keyframes shimmer{0%{transform:translateX(-100%) rotate(45deg);}100%{transform:translateX(100%) rotate(45deg);} }

    /* Small stats (D√©pense / Profit) - structure updated to underline directly under amount */
    .small-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-bottom:20px;}
    .small-stat-card{border-radius:10px;padding:14px;box-shadow:var(--shadow);position:relative;overflow:visible;height:120px;display:flex;flex-direction:column;justify-content:center;}
    .small-stat-card:nth-child(1){background:linear-gradient(135deg,#ff6b6b 0%,#c62828 100%);color:#fff;}
    .small-stat-card:nth-child(2){background:linear-gradient(135deg,#4cd964 0%,#2e7d32 100%);color:#fff;}
    .small-stat-title{font-size:0.9rem;opacity:0.95;margin-bottom:6px;display:flex;align-items:center;gap:8px;}
    /* wrapper around value so we can place underline just under text */
    .value-wrapper{position:relative;display:flex;justify-content:center;align-items:center;flex-direction:column;padding-bottom:12px;}
    .small-stat-value{font-size:1.6rem;font-weight:700;color:#fff;z-index:2;}

    /* underline (progress) just under the amount, centered */
    .progress-underline {
      position:absolute;
      bottom:6px; /* just under the text */
      left:50%;
      transform:translateX(-50%);
      width:66%;
      height:8px;
      background:rgba(255,255,255,0.12);
      border-radius:8px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      z-index:1;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    .progress-underline .bar {
      height:100%;
      width:0%;
      border-radius:8px;
      transition:width 1s cubic-bezier(.2,.9,.2,1);
      box-shadow:0 0 12px rgba(255,255,255,0.35);
      background:linear-gradient(90deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.95) 100%);
    }
    /* default widths (will be overridden by JS based on data) */
    #depense-card .bar { width:40%; }
    #profit-card .bar { width:65%; }

    /* Large stat card (Solde) - add water fill */
    .large-stats{margin-bottom:18px;display:grid;gap:18px;}
    .large-stat-card{
      position:relative;border-radius:12px;padding:22px;overflow:hidden;box-shadow:var(--shadow);min-height:150px;color:#fff;background:linear-gradient(135deg,#a2d2ff 0%,#5c9ce6 100%);
    }
    .large-stat-card .large-stat-value{font-size:2rem;font-weight:700;margin-bottom:6px;z-index:3;position:relative;}
    /* water fill wrapper (absolute) - uses CSS variable --water-level */
    .water-fill{
      position:absolute;left:0;right:0;bottom:0;height:var(--water-level, 40%);pointer-events:none;overflow:hidden;z-index:2;
      transition:height 0.8s ease;
    }
    /* wave SVG inside fill */
    .water-fill svg{position:absolute;left:0;bottom:0;width:200%;height:80px;transform:translateX(0);animation:waveMove 6s linear infinite;opacity:0.95;}
    @keyframes waveMove{0%{transform:translateX(0);}100%{transform:translateX(-50%);} }

    /* medium stats (Retir√©, etc.) - we'll add water for the specific ones */
    .medium-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:26px;}
    .medium-stat-card{position:relative;border-radius:12px;padding:18px;min-height:130px;box-shadow:var(--shadow);overflow:hidden;color:#fff;}
    .medium-stat-card .medium-stat-value{font-size:1.6rem;font-weight:700;z-index:3;position:relative;}
    /* add water-fill to any medium-stat-card that needs it as well */

    /* gain-stats kept as before (small animated cards) */
    .gain-stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:15px;margin-bottom:30px;}
    .gain-stat-card{border-radius:10px;padding:14px;box-shadow:var(--shadow);height:110px;position:relative;overflow:hidden;transition:transform .28s;}
    .gain-stat-card:hover{transform:translateY(-6px) scale(1.01);}
    .gain-stat-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
    .gain-stat-icon{width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,0.28);display:flex;align-items:center;justify-content:center;color:var(--primary-color);}

    /* per-card backgrounds */
    .gain-stat-card:nth-child(1){background:linear-gradient(135deg,#d4ffd4 0%,#a0f0a0 100%);}
    .gain-stat-card:nth-child(2){background:linear-gradient(135deg,#ffd4f0 0%,#f0a0d4 100%);}
    .gain-stat-card:nth-child(3){background:linear-gradient(135deg,#d4f0ff 0%,#a0d4f0 100%);}
    .gain-stat-card:nth-child(4){background:linear-gradient(135deg,#fff0d4 0%,#f0d4a0 100%);}
    .gain-stat-card:nth-child(5){background:linear-gradient(135deg,#e6d4ff 0%,#c8a0f0 100%);}
    .gain-stat-card:nth-child(6){background:linear-gradient(135deg,#d4fff0 0%,#a0f0d4 100%);}

    /* small responsive & UI niceties */
    @media(max-width:992px){.sidebar{width:230px}.medium-stats{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:768px){.main-container{flex-direction:column}.sidebar{position:fixed;left:-50%;top:80px;height:100vh;z-index:99;transition:left .28s}.sidebar.active{left:0}}
    .hamburger-menu{display:none}@media(max-width:768px){.hamburger-menu{display:block}}

    /* calendar / other styles kept (abbreviated for clarity) */
    .fidelity-section{background:linear-gradient(135deg,#e6fffd 0%,#b2fff8 100%);border-radius:12px;padding:20px;margin-bottom:22px;box-shadow:var(--shadow);position:relative;}
    .referral-section{background:linear-gradient(135deg,#e0f7fa 0%,#b2ebf2 100%);border-radius:12px;padding:20px;margin-bottom:22px;box-shadow:var(--shadow);position:relative;}
    .user-info-section{background:linear-gradient(135deg,#f3e5f5 0%,#e1bee7 100%);border-radius:12px;padding:20px;margin-bottom:22px;box-shadow:var(--shadow)}
    .task-calendar{background:linear-gradient(135deg,#fff3e0 0%,#ffe0b2 100%);border-radius:12px;padding:20px;margin-bottom:22px;box-shadow:var(--shadow)}
    .footer{background:var(--card-bg);padding:18px;text-align:center;box-shadow:0 -4px 12px rgba(0,0,0,0.08);margin-top:auto}
  </style>
</head>
<body>
  <!-- Loader -->
  <div class="loader-container" id="loader">
    <div class="loader" aria-hidden="true"></div>
  </div>

  <!-- Notifications -->
  <div class="notification-container" id="notificationContainer"></div>

  <!-- Header -->
  <header class="header">
    <button class="hamburger-menu" id="hamburgerMenu"><i class="fas fa-bars"></i></button>
    <div class="logo">MULAFLOWR</div>
    <div class="header-controls">
      <button class="language-selector" id="languageSelector"><i class="fas fa-globe"></i><span>French</span></button>
      <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i><span>Mode nuit</span></button>
      <div class="user-profile" id="userProfile"><div class="avatar" id="userAvatar">U</div></div>
    </div>
  </header>

  <div class="overlay" id="overlay"></div>

  <div class="main-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="welcome-section">
        <div class="welcome-text">Dashboard >> MULAFLOWR</div>
        <div class="username" id="sidebarUsername">Utilisateur</div>
      </div>
      <div class="menu-category">PRINCIPAL</div>
      <a href="dashboard.html" class="menu-item active"><i class="fas fa-home"></i><span>Tableau de bord</span><span class="menu-badge">‚òë</span></a>
      <a href="depot.html" class="menu-item"><i class="fas fa-wallet"></i><span>D√©p√¥t üíµ</span><span class="menu-badge">‚òê</span></a>
      <a href="bonus_bienvenue.html" class="menu-item"><i class="fas fa-gift"></i><span>Bonus de bienvenue</span><span class="menu-badge">‚òí</span></a>
      <div class="menu-category">COMPTES</div>
      <a href="retrait.html" class="menu-item"><i class="fas fa-money-bill-wave"></i><span>Retrait</span><span class="menu-badge">‚òê</span></a>
      <a href="equipe.html" class="menu-item"><i class="fas fa-users"></i><span>√âquipe</span><span class="menu-badge">‚òí</span></a>
      <div class="menu-category">SP√âCIAL</div>
      <a href="love_earn.html" class="menu-item"><i class="fas fa-heart"></i><span>LoveEarn</span><span class="menu-badge">‚òê</span></a>
      <a href="social_boost.html" class="menu-item"><i class="fas fa-rocket"></i><span>SBH</span><span class="menu-badge">‚òê</span></a>
      <a href="challenge_reward.html" class="menu-item"><i class="fas fa-medal"></i><span>Challenge and Reward</span><span class="menu-badge">‚òê</span></a>

      <div class="menu-category">PRODUIT / TACHE</div>
      <a href="whatsapp_earn.html" class="menu-item"><i class="fab fa-whatsapp"></i><span>Gagner via Whatsapp</span><span class="menu-badge">‚òê</span></a>
      <a href="movies.html" class="menu-item"><i class="fas fa-film"></i><span>Movies</span><span class="menu-badge">‚òê</span></a>
      <a href="paris_fixes.html" class="menu-item"><i class="fas fa-chart-line"></i><span>Paris fixes</span><span class="menu-badge">‚òê</span></a>
      <a href="gains_publicitaires.html" class="menu-item"><i class="fas fa-ad"></i><span>Gains publicitaires</span><span class="menu-badge">‚òê</span></a>
      <a href="spin_wheel.html" class="menu-item"><i class="fas fa-trophy"></i><span>Spin wheel üèÜ</span><span class="menu-badge">‚òê</span></a>
      <a href="tiktok_earn.html" class="menu-item"><i class="fab fa-tiktok"></i><span>TikTok Earn</span><span class="menu-badge">‚òê</span></a>
      <a href="youtube_earn.html" class="menu-item"><i class="fab fa-youtube"></i><span>YouTube Earn</span><span class="menu-badge">‚òê</span></a>
      <a href="instagram_earn.html" class="menu-item"><i class="fab fa-instagram"></i><span>Instagram Earn</span><span class="menu-badge">‚òê</span></a>
      <a href="trivia_challenge.html" class="menu-item"><i class="fas fa-brain"></i><span>TRIVIA challenge</span><span class="menu-badge">‚òê</span></a>

      <div class="menu-category">BONUS</div>
      <a href="liste_contacts.html" class="menu-item"><i class="fas fa-address-book"></i><span>Liste de contacts gratuit üÜì</span><span class="menu-badge">‚òê</span></a>
      <a href="booster_visibilite.html" class="menu-item"><i class="fas fa-rocket"></i><span>Booster ma visibilit√©</span><span class="menu-badge">‚òê</span></a>
      <a href="canva_pro.html" class="menu-item"><i class="fas fa-palette"></i><span>Canva Pro</span><span class="menu-badge">‚òê</span></a>
      <a href="connexion_gratuite.html" class="menu-item"><i class="fas fa-shield-alt"></i><span>Connexion gratuite</span><span class="menu-badge">‚òê</span></a>
    </aside>

    <main class="content">
      <h1 class="page-title"><i class="fas fa-home"></i><span>Dashboard >> MULAFLOWR</span></h1>

      <div class="banner">
        <div class="banner-title">MULAFLOWR</div>
        <div class="banner-text">D√©bloquez plus de 10 outils num√©riques avec MULAFLOWR, des annonces aux promotions YouTube et trivia, sp√©cialement con√ßus pour VOUS ! Am√©liorez votre pr√©sence en ligne d√®s maintenant ! üí¨</div>
        <a class="banner-link" href="https://web2apkpro.com/public_download.php?project_id=501&token=9553436f25" style="background:#fff;color:var(--primary-color;padding:8px 12px;border-radius:16px;text-decoration:none;font-weight:700;">CLIQUEZ ICI pour obtenir l'application Android</a>
      </div>

      <!-- Small stats: Depense / Profit -->
      <div class="small-stats">
        <div class="small-stat-card" id="depense-card">
          <div class="small-stat-title"><i class="fas fa-arrow-down"></i> D√©pense:</div>
          <div class="value-wrapper">
            <div class="small-stat-value" id="depense-value">XAF 0</div>
            <!-- underline (progress) positioned JUSTE sous le montant -->
            <div class="progress-underline" aria-hidden="true">
              <div class="bar" id="dep-bar"></div>
            </div>
          </div>
        </div>

        <div class="small-stat-card" id="profit-card">
          <div class="small-stat-title"><i class="fas fa-arrow-up"></i> Profit:</div>
          <div class="value-wrapper">
            <div class="small-stat-value" id="profit-value">XAF 0</div>
            <div class="progress-underline" aria-hidden="true">
              <div class="bar" id="profit-bar"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Large stat (Solde) with water fill (level ~45%) -->
      <div class="large-stats">
        <div class="large-stat-card" id="solde-card" style="--water-level:45%;">
          <div style="position:relative;z-index:3;">
            <div class="large-stat-title"><i class="fas fa-piggy-bank"></i> SOLDE</div>
            <div class="large-stat-value" id="solde-value">XAF 0</div>
            <div class="stat-change"><span>Vol:(0%)</span></div>
          </div>
          <!-- water fill (SVG wave) -->
          <div class="water-fill" aria-hidden="true">
            <svg viewBox="0 0 1200 80" preserveAspectRatio="none">
              <path d="M0,40 C150,80 300,0 600,40 C900,80 1050,0 1200,40 L1200,80 L0,80 Z" fill="rgba(255,255,255,0.14)"></path>
              <path d="M0,48 C150,12 300,80 600,48 C900,12 1050,80 1200,48 L1200,80 L0,80 Z" fill="rgba(255,255,255,0.10)"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Medium stats: Retir√©, Parrainage, Bonus agent (apply water to some) -->
      <div class="medium-stats">
        <div class="medium-stat-card" id="retire-card" style="--water-level:30%;background:linear-gradient(135deg,#ffc7a2 0%,#ff9a5c 100%);">
          <div style="position:relative;z-index:3;"><div class="medium-stat-title"><i class="fas fa-download"></i> Retir√©</div><div class="medium-stat-value" id="retire-value">XAF 0</div></div>
          <div class="water-fill" aria-hidden="true">
            <svg viewBox="0 0 1200 80" preserveAspectRatio="none">
              <path d="M0,40 C150,80 300,0 600,40 C900,80 1050,0 1200,40 L1200,80 L0,80 Z" fill="rgba(255,255,255,0.12)"></path>
            </svg>
          </div>
        </div>

        <div class="medium-stat-card" id="parrainage-card" style="--water-level:25%;background:linear-gradient(135deg,#c2a2ff 0%,#8c5ce7 100%);">
          <div style="position:relative;z-index:3;"><div class="medium-stat-title"><i class="fas fa-users"></i> Gains de parrainage</div><div class="medium-stat-value" id="parrain-value">XAF 0</div></div>
          <div class="water-fill" aria-hidden="true">
            <svg viewBox="0 0 1200 80" preserveAspectRatio="none">
              <path d="M0,40 C150,10 300,60 600,40 C900,20 1050,60 1200,40 L1200,80 L0,80 Z" fill="rgba(255,255,255,0.10)"></path>
            </svg>
          </div>
        </div>

        <div class="medium-stat-card" id="bonus-agent-card" style="background:linear-gradient(135deg,#a2ffc7 0%,#5ce78c 100%);">
          <div style="position:relative;z-index:3;"><div class="medium-stat-title"><i class="fas fa-gift"></i> Bonus d'agent</div><div class="medium-stat-value" id="bonus-value">XAF 0</div></div>
          <!-- optional water omitted here (kept clean) -->
        </div>
      </div>

      <!-- Fidelity -->
      <div class="fidelity-section">
        <h2 class="section-title">CL√â DE FID√âLIT√â</h2>
        <p>Utilisez votre cl√© de fid√©lit√© pour acc√©der √† des avantages exclusifs et des bonus suppl√©mentaires.</p>
        <div class="fidelity-key">
          <i class="fas fa-key" style="font-size:1.2rem;color:var(--primary-color);"></i>
          <div style="flex:1;font-family:monospace;" id="fidelityKey">MULA-USER-2024-0000-0000</div>
          <div style="display:flex;gap:8px;">
            <button class="copy-key-btn" id="copyKeyBtn" style="background:var(--primary-color);color:#fff;padding:8px;border-radius:6px;border:none;"><i class="fas fa-copy"></i> Copier</button>
            <button class="send-key-btn" id="sendKeyBtn" style="background:#25D366;color:#fff;padding:8px;border-radius:6px;border:none;"><i class="fab fa-whatsapp"></i> Envoyer</button>
          </div>
        </div>
      </div>

      <!-- Gain stats including deposit (we add water to deposit card) -->
      <div class="gain-stats">
        <div class="gain-stat-card" id="whatsapp-gains"><div class="gain-stat-header"><div class="gain-stat-title">Gains WhatsApp</div><div class="gain-stat-icon"><i class="fab fa-whatsapp"></i></div></div><div class="gain-stat-value" id="wa-value">XAF 0</div></div>
        <div class="gain-stat-card" id="trivia-gains"><div class="gain-stat-header"><div class="gain-stat-title">Gains Trivia</div><div class="gain-stat-icon"><i class="fas fa-question-circle"></i></div></div><div class="gain-stat-value" id="trivia-value">XAF 0</div></div>
        <div class="gain-stat-card" id="publicite-gains"><div class="gain-stat-header"><div class="gain-stat-title">Gains publicitaires</div><div class="gain-stat-icon"><i class="fas fa-ad"></i></div></div><div class="gain-stat-value" id="pub-value">XAF 0</div></div>
        <div class="gain-stat-card" id="tiktok-gains"><div class="gain-stat-header"><div class="gain-stat-title">Gains TikTok</div><div class="gain-stat-icon"><i class="fab fa-tiktok"></i></div></div><div class="gain-stat-value" id="tiktok-value">XAF 0</div></div>
        <div class="gain-stat-card" id="youtube-gains"><div class="gain-stat-header"><div class="gain-stat-title">Gains YouTube</div><div class="gain-stat-icon"><i class="fab fa-youtube"></i></div></div><div class="gain-stat-value" id="yt-value">XAF 0</div></div>

        <!-- Depot solde with water (35%) -->
        <div class="gain-stat-card" id="depot-solde" style="position:relative;--water-level:35%;background:linear-gradient(135deg,#d4fff0 0%,#a0f0d4 100%);">
          <div style="position:relative;z-index:3;" class="gain-stat-header">
            <div class="gain-stat-title">Solde du d√©p√¥t</div>
            <div class="gain-stat-icon"><i class="fas fa-piggy-bank"></i></div>
          </div>
          <div class="gain-stat-value" id="depot-value">XAF 0</div>
          <div class="water-fill" aria-hidden="true">
            <svg viewBox="0 0 1200 80" preserveAspectRatio="none">
              <path d="M0,40 C150,80 300,0 600,40 C900,80 1050,0 1200,40 L1200,80 L0,80 Z" fill="rgba(255,255,255,0.12)"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Referral -->
      <div class="referral-section">
        <h2 class="section-title">LIEN DE PARRAINAGE</h2>
        <div class="referral-content">
          <div style="flex:1;min-width:300px;">
            <div style="background:rgba(0,0,0,0.05);padding:12px;border-radius:8px;display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
              <div style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" id="referralLink">mulaflowr.com/?ref=USER000X0</div>
              <button id="copyLinkBtn" class="copy-btn" style="background:var(--primary-color);color:#fff;border:none;padding:8px;border-radius:6px;"><i class="fas fa-copy"></i> Copier</button>
            </div>
            <div style="display:flex;gap:10px;">
              <div class="social-btn whatsapp" id="shareWhatsApp" style="background:#25D366;padding:8px;border-radius:50%;color:#fff;cursor:pointer"><i class="fab fa-whatsapp"></i></div>
              <div class="social-btn facebook" id="shareFacebook" style="background:#3b5998;padding:8px;border-radius:50%;color:#fff;cursor:pointer"><i class="fab fa-facebook-f"></i></div>
              <div class="social-btn twitter" id="shareTwitter" style="background:#1DA1F2;padding:8px;border-radius:50%;color:#fff;cursor:pointer"><i class="fab fa-twitter"></i></div>
              <div class="social-btn telegram" id="shareTelegram" style="background:#0088cc;padding:8px;border-radius:50%;color:#fff;cursor:pointer"><i class="fab fa-telegram-plane"></i></div>
            </div>
          </div>
        </div>
      </div>

      <!-- User info -->
      <div class="user-info-section">
        <h2 class="section-title">INFORMATIONS UTILISATEUR</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;">
          <div><div class="info-label">Nom d'utilisateur</div><div id="info-username">Chargement...</div></div>
          <div><div class="info-label">Email</div><div id="info-email">Chargement...</div></div>
          <div><div class="info-label">T√©l√©phone</div><div id="info-phone">Chargement...</div></div>
          <div><div class="info-label">Pays</div><div id="info-country">Chargement...</div></div>
          <div><div class="info-label">Parrain</div><div id="info-parrain">Chargement...</div></div>
          <div><div class="info-label">Parrainage actif</div><div id="info-parrainage">0 personnes</div></div>
        </div>
      </div>

      <!-- Calendar (kept) -->
      <div class="task-calendar">
        <h2 class="section-title">CALENDRIER DES T√ÇCHES</h2>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
          <div class="calendar-month" id="calendarMonth">Septembre 2025</div>
          <div style="display:flex;gap:8px;">
            <div class="nav-btn" id="prevMonth" style="background:var(--primary-light);color:#fff;padding:8px;border-radius:50%;cursor:pointer"><i class="fas fa-chevron-left"></i></div>
            <div class="nav-btn" id="nextMonth" style="background:var(--primary-light);color:#fff;padding:8px;border-radius:50%;cursor:pointer"><i class="fas fa-chevron-right"></i></div>
          </div>
        </div>
        <div class="calendar-days" style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-bottom:10px;">
          <div style="text-align:center;font-weight:700;color:var(--text-light)">Lun</div><div style="text-align:center;font-weight:700;color:var(--text-light)">Mar</div><div style="text-align:center;font-weight:700;color:var(--text-light)">Mer</div><div style="text-align:center;font-weight:700;color:var(--text-light)">Jeu</div><div style="text-align:center;font-weight:700;color:var(--text-light)">Ven</div><div style="text-align:center;font-weight:700;color:var(--text-light)">Sam</div><div style="text-align:center;font-weight:700;color:var(--text-light)">Dim</div>
        </div>
        <div class="calendar-grid" id="calendarGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;"></div>
      </div>
    </main>
  </div>

  <footer class="footer">
    <div style="display:flex;justify-content:center;gap:18px;flex-wrap:wrap;">
      <a href="https://social-boost-horizon-new-sbh.vercel.app" style="color:var(--primary-color);text-decoration:none">Pro Tech Management</a>
      <a href="https://social-boost-horizon-new-sbh.vercel.app" style="color:var(--primary-color);text-decoration:none">Site propuls√© par Social Boost Horizon</a>
    </div>
    <div style="color:var(--text-light);margin-top:8px">¬© 2025 MULAFLOWR. Tous droits r√©serv√©s.</div>
  </footer>

  <script>
    /******** Firebase config ********/
    const firebaseConfig = {
      apiKey: "AIzaSyCjGisjgbFc2ZE0BFgdhlUao8bCCeuKP1k",
      authDomain: "cash-flowr.firebaseapp.com",
      projectId: "cash-flowr",
      storageBucket: "cash-flowr.firebasestorage.app",
      messagingSenderId: "1091928501310",
      appId: "1:1091928501310:web:4f4de306cde36f378ff56f",
      measurementId: "G-5SF6VDLZCB"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    /* DOM */
    const loader = document.getElementById('loader');
    const notificationContainer = document.getElementById('notificationContainer');
    const depBar = document.getElementById('dep-bar');
    const profitBar = document.getElementById('profit-bar');
    const depValueEl = document.getElementById('depense-value');
    const profitValueEl = document.getElementById('profit-value');
    const soldeValue = document.getElementById('solde-value');
    const retireValue = document.getElementById('retire-value');
    const parrainValue = document.getElementById('parrain-value');
    const depotValue = document.getElementById('depot-value');

    /* calendar */
    const calendarGrid = document.getElementById('calendarGrid');
    const calendarMonth = document.getElementById('calendarMonth');
    let currentDate = new Date();

    /* state */
    let currentUser = null;
    let userData = {
      depense:0, profit:0, solde:0, retire:0, parrainage:0, bonusAgent:0,
      whatsappGains:0, triviaGains:0, publiciteGains:0, tiktokGains:0, youtubeGains:0, depotSolde:0,
      paid:false, phoneNumber:"", country:"", referrer:"", activeReferrals:0
    };
    let hasRedirected = false;

    /* helper notifications */
    function showNotification(type,title,msg,ms=3000){
      const n = document.createElement('div');
      n.className = 'notification ' + (type||'success');
      n.style.padding = '12px 14px';
      n.style.borderRadius = '8px';
      n.style.color = '#fff';
      n.style.background = (type==='error') ? 'linear-gradient(135deg,#ff5b5b,#c0392b)' : 'linear-gradient(135deg,#28d27f,#1b8a3a)';
      n.innerHTML = `<strong style="display:block;margin-bottom:6px">${title}</strong><div>${msg}</div>`;
      notificationContainer.appendChild(n);
      setTimeout(()=>{ n.style.opacity = 0; setTimeout(()=>n.remove(),300); }, ms);
    }

    /* calendar simple */
    function updateCalendar(){
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const monthNames = ["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];
      calendarMonth.textContent = monthNames[month] + ' ' + year;
      calendarGrid.innerHTML = '';
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month+1,0).getDate();
      let start = firstDay===0?6:firstDay-1;
      for(let i=0;i<start;i++){ const cell=document.createElement('div');cell.className='calendar-date';cell.style.height='36px';calendarGrid.appendChild(cell); }
      for(let d=1; d<=daysInMonth; d++){ const cell=document.createElement('div');cell.className='calendar-date';cell.style.height='36px';cell.style.display='flex';cell.style.alignItems='center';cell.style.justifyContent='center';cell.textContent=d; if(Math.random()>0.7){const dot=document.createElement('div');dot.style.position='absolute';dot.style.bottom='6px';dot.style.width='6px';dot.style.height='6px';dot.style.borderRadius='50%';dot.style.background='#4CD964';cell.appendChild(dot);} calendarGrid.appendChild(cell);}
    }
    document.getElementById('prevMonth')?.addEventListener('click',()=>{ currentDate.setMonth(currentDate.getMonth()-1); updateCalendar(); });
    document.getElementById('nextMonth')?.addEventListener('click',()=>{ currentDate.setMonth(currentDate.getMonth()+1); updateCalendar(); });
    updateCalendar();

    /* format */
    function formatN(n){ return (typeof n==='number' && !isNaN(n)) ? n.toLocaleString() : '0'; }

    /* paid detection */
    function isPaidFlag(v){
      if(v===true) return true;
      if(typeof v==='string'){ const s=v.toLowerCase().trim(); return ['true','yes','paid','pay√©','complete','completed','1'].includes(s); }
      if(typeof v==='number') return v===1;
      return false;
    }
    function isUserPaidFromDoc(docData){
      if(!docData) return false;
      const cand=[docData.paid,docData.isPaid,docData.paymentStatus,docData.status,docData.statut,docData.paiement];
      for(const c of cand) if(c!==undefined && c!==null && isPaidFlag(c)) return true;
      return false;
    }

    /* update UI values + underline widths + water heights */
    function updateDashboardUI(){
      try{
        // values
        depValueEl.textContent = 'XAF ' + formatN(userData.depense);
        profitValueEl.textContent = 'XAF ' + formatN(userData.profit);
        soldeValue.textContent = 'XAF ' + formatN(userData.solde);
        retireValue.textContent = 'XAF ' + formatN(userData.retire);
        parrainValue.textContent = 'XAF ' + formatN(userData.parrainage);
        depotValue.textContent = 'XAF ' + formatN(userData.depotSolde);

        // progress bar percentages: compute relative if possible; defaults preserved
        const total = (userData.depense||0) + (userData.profit||0);
        let depPct=40, profPct=65;
        if(total>0){
          depPct = Math.round((userData.depense/total)*100);
          profPct = Math.round((userData.profit/total)*100);
          if(depPct<6) depPct=6; if(profPct<6) profPct=6;
          if(depPct>94) depPct=94; if(profPct>94) profPct=94;
        }
        // animate widths
        requestAnimationFrame(()=>{ depBar.style.width = depPct + '%'; profitBar.style.width = profPct + '%'; });

        // water levels: if you have fields in userData for levels you can plug here; else defaults from CSS inline.
        // Example: adjust water heights slightly based on solde/depot values
        // We'll keep CSS variable inline but allow dynamic update:
        const solCard = document.getElementById('solde-card');
        const retireCard = document.getElementById('retire-card');
        const parrainCard = document.getElementById('parrainage-card');
        const depotCard = document.getElementById('depot-solde');

        // If values present, compute level percent heuristically, else keep defaults
        if(solCard){
          let lvl = 45;
          if(userData.solde && userData.solde>0) lvl = Math.min(70, 30 + Math.log10(Math.max(1,userData.solde))*4);
          solCard.style.setProperty('--water-level', lvl + '%');
        }
        if(retireCard){
          let lvl = 30;
          if(userData.retire && userData.retire>0) lvl = Math.min(60, 14 + Math.log10(Math.max(1,userData.retire))*3.5);
          retireCard.style.setProperty('--water-level', lvl + '%');
        }
        if(parrainCard){
          let lvl = 25;
          if(userData.parrainage && userData.parrainage>0) lvl = Math.min(60, 12 + userData.parrainage*3);
          parrainCard.style.setProperty('--water-level', lvl + '%');
        }
        if(depotCard){
          let lvl = 35;
          if(userData.depotSolde && userData.depotSolde>0) lvl = Math.min(65, 20 + Math.log10(Math.max(1,userData.depotSolde))*4);
          depotCard.style.setProperty('--water-level', lvl + '%');
        }

      }catch(e){ console.error('updateDashboardUI error', e); }
    }

    /* update user info UI */
    function updateUserInfoUI(docData){
      const displayName = (docData && (docData.displayName || docData.name)) || currentUser?.displayName || currentUser?.email || 'Utilisateur';
      document.getElementById('sidebarUsername').textContent = displayName;
      document.getElementById('userAvatar').textContent = displayName.charAt(0).toUpperCase();
      document.getElementById('info-username').textContent = displayName;
      document.getElementById('info-email').textContent = (docData && docData.email) || currentUser?.email || 'Non sp√©cifi√©';
      document.getElementById('info-phone').textContent = (docData && (docData.phoneNumber || docData.phone)) || 'Non sp√©cifi√©';
      document.getElementById('info-country').textContent = (docData && (docData.country || docData.pays)) || 'Non sp√©cifi√©';
      document.getElementById('info-parrain').textContent = (docData && (docData.referrer || docData.parrain)) || 'Aucun';
      document.getElementById('info-parrainage').textContent = ((docData && (docData.activeReferrals || docData.parrainageCount)) || userData.activeReferrals || 0) + ' personnes';

      // fidelity + referral text
      const fidelity = document.getElementById('fidelityKey');
      const refEl = document.getElementById('referralLink');
      if(fidelity) fidelity.textContent = `MULA-${displayName.substring(0,5)}-2024-${Math.floor(1000+Math.random()*9000)}-${Math.floor(1000+Math.random()*9000)}`;
      if(refEl) refEl.textContent = `mulaflowr.com/?ref=${displayName.substring(0,5)}${Math.floor(100+Math.random()*900)}X${Math.floor(Math.random()*9)}`;
    }

    /* save user data (merge) */
    async function saveUserData(key=null,value=null){
      if(!currentUser) return;
      try{
        const userRef = db.collection('users').doc(currentUser.uid);
        if(key!==null){
          await userRef.set({[key]:value,lastUpdate:new Date()}, {merge:true});
        } else {
          await userRef.set({...userData, uid: currentUser.uid, email: currentUser.email, displayName: currentUser.displayName || currentUser.email, lastUpdate:new Date()}, {merge:true});
        }
      }catch(e){ console.error('saveUserData error', e); }
    }

    /* load user data */
    async function loadUserData(){
      if(!currentUser) return;
      try{
        const doc = await db.collection('users').doc(currentUser.uid).get();
        if(doc.exists){
          const data = doc.data() || {};
          userData.depense = Number(data.depense || data.debit || data.expense || 0) || 0;
          userData.profit = Number(data.profit || data.revenue || 0) || 0;
          userData.solde = Number(data.solde || data.balance || data.soldeAccount || 0) || 0;
          userData.retire = Number(data.retire || data.withdrawn || 0) || 0;
          userData.parrainage = Number(data.parrainage || data.referralEarnings || 0) || 0;
          userData.bonusAgent = Number(data.bonusAgent || data.agentBonus || 0) || 0;
          userData.whatsappGains = Number(data.whatsappGains || 0) || 0;
          userData.triviaGains = Number(data.triviaGains || 0) || 0;
          userData.publiciteGains = Number(data.publiciteGains || 0) || 0;
          userData.tiktokGains = Number(data.tiktokGains || 0) || 0;
          userData.youtubeGains = Number(data.youtubeGains || 0) || 0;
          userData.depotSolde = Number(data.depotSolde || data.depositBalance || 0) || 0;
          userData.phoneNumber = data.phoneNumber || data.phone || "";
          userData.country = data.country || data.pays || "";
          userData.referrer = data.referrer || data.parrain || data.referral || "";
          userData.activeReferrals = Number(data.activeReferrals || data.parrainageCount || 0) || 0;
          userData.paid = isUserPaidFromDoc(data);
          if(data.displayName) userData.displayName = data.displayName;
          if(data.email) userData.email = data.email;
          updateDashboardUI();
          updateUserInfoUI(data);
        } else {
          await saveUserData();
        }
      }catch(e){ console.error('loadUserData error', e); }
    }

    function checkUserPaymentAndAct(){
      if(!isUserPaidFromDoc(userData) && !isPaidFlag(userData.paid)){
        showNotification('error','Paiement requis','Veuillez finaliser votre paiement pour acc√©der √† toutes les fonctionnalit√©s.',2500);
        if(!hasRedirected){ hasRedirected=true; setTimeout(()=>{ window.location.href='paiement.html'; },900); }
        return false;
      }
      return true;
    }

    /* Auth handling */
    auth.onAuthStateChanged(async (user)=>{
      try{
        if(user){
          currentUser = user;
          await loadUserData();
          const ok = checkUserPaymentAndAct();
          if(!ok) return;
          // reveal page and hide loader smoothly
          document.documentElement.style.visibility = 'visible';
          loader.classList.add('hidden');
          setTimeout(()=>{ loader.parentNode && loader.parentNode.removeChild(loader); }, 600);
          showNotification('success','Bienvenue', `Content de vous revoir, ${user.displayName || user.email}!`, 1500);
        } else {
          if(!hasRedirected){
            hasRedirected = true;
            // reveal page so user sees the login redirect briefly (prevents white flash)
            document.documentElement.style.visibility = 'visible';
            loader.classList.add('hidden');
            setTimeout(()=>{ try{ loader.parentNode && loader.parentNode.removeChild(loader); }catch(e){} },600);
            window.location.href = 'login.html';
          }
        }
      }catch(e){
        console.error('onAuthStateChanged error', e);
        if(!hasRedirected){ hasRedirected=true; window.location.href='login.html'; }
      }
    });

    /* Copy / share actions */
    document.getElementById('copyLinkBtn')?.addEventListener('click', ()=>{ navigator.clipboard.writeText(document.getElementById('referralLink').textContent).then(()=>showNotification('success','Succ√®s','Lien copi√©!')).catch(e=>showNotification('error','Erreur','Impossible de copier')); });
    document.getElementById('copyKeyBtn')?.addEventListener('click', ()=>{ navigator.clipboard.writeText(document.getElementById('fidelityKey').textContent).then(()=>showNotification('success','Succ√®s','Cl√© copi√©e!')).catch(()=>showNotification('error','Erreur','Impossible')); });
    document.getElementById('sendKeyBtn')?.addEventListener('click', ()=>{ const msg = encodeURIComponent("Voici ma cl√© MULAFLOWR: "+document.getElementById('fidelityKey').textContent); window.open(`https://wa.me/?text=${msg}`,'_blank'); });

    const shareMsg = "Tu veux gagner de l'argent en ligne? Voici un lien: ";
    document.getElementById('shareWhatsApp')?.addEventListener('click', ()=>{ window.open(`https://wa.me/?text=${encodeURIComponent(shareMsg + document.getElementById('referralLink').textContent)}`,'_blank'); });
    document.getElementById('shareFacebook')?.addEventListener('click', ()=>{ window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(document.getElementById('referralLink').textContent)}`,'_blank'); });
    document.getElementById('shareTwitter')?.addEventListener('click', ()=>{ window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareMsg)}&url=${encodeURIComponent(document.getElementById('referralLink').textContent)}`,'_blank'); });
    document.getElementById('shareTelegram')?.addEventListener('click', ()=>{ window.open(`https://t.me/share/url?url=${encodeURIComponent(shareMsg + document.getElementById('referralLink').textContent)}`,'_blank'); });

    /* small UI: hamburger */
    document.getElementById('hamburgerMenu')?.addEventListener('click', ()=>{ document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); });
    document.getElementById('overlay')?.addEventListener('click', ()=>{ document.getElementById('sidebar').classList.remove('active'); document.getElementById('overlay').classList.remove('active'); });

    /* periodic save */
    setInterval(()=>{ if(currentUser) saveUserData(); }, 30000);

    /* DOM ready fallback: keep updateCalendar ready */
    document.addEventListener('DOMContentLoaded', ()=>{ updateCalendar(); });

  </script>
</body>
</html>