<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MULAFLOWR - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    :root {
      --primary-color: #3a8ee6; --primary-light: #4da6ff; --primary-dark: #2c75c9; --secondary-color: #4c566a; --accent-color: #5e81ac; --background-light: #f5f7fb; --background-dark: #e5e9f0; --card-bg: #ffffff; --text-color: #2e3440; --text-light: #4c566a; --success-color: #4CD964; --warning-color: #FF9500; --danger-color: #FF3B30; --shadow: 0 4px 12px rgba(0, 0, 0, 0.08); --transition: all 0.3s ease; --username-color: #FFD700;
    }
    .dark-mode {
      --primary-color: #5e81ac; --primary-light: #81a1c1; --primary-dark: #4c566a; --secondary-color: #d8dee9; --accent-color: #88c0d0; --background-light: #2e3440; --background-dark: #3b4252; --card-bg: #434c5e; --text-color: #eceff4; --text-light: #d8dee9; --shadow: 0 4px 12px rgba(0, 0, 0, 0.25); --username-color: #FFA500;
    }
    html, body { height: 100%; }
    body {
      background: linear-gradient(135deg, #d5e8d9 0%, #c5dfe6 100%);
      color: var(--text-color); margin: 0; padding: 0;
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .dark-mode { background: var(--background-light); }
    * { box-sizing: border-box; }

    #app-wrapper {
      display: none; flex-direction: column; min-height: 100vh;
      visibility: hidden; opacity: 0;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    #app-wrapper.loaded { display: flex; visibility: visible; opacity: 1; }

    .loader-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, #d5e8d9 0%, #c5dfe6 100%);
      display: flex; justify-content: center; align-items: center; z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .dark-mode .loader-container { background: var(--background-dark); }
    .loader-container.hidden { opacity: 0; visibility: hidden; }
    .loader {
      width: 60px; height: 60px; border-radius: 50%;
      background: conic-gradient(#0000 10%, var(--primary-color));
      -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 8px), #000 0);
      animation: spin 1s infinite linear;
    }
    @keyframes spin { to { transform: rotate(1turn); } }

    /* Header, Sidebar, Content, Footer et tous les autres styles */
    .header { background-color: var(--card-bg); box-shadow: var(--shadow); padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
    .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary-color); font-family: 'Montserrat', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
    .header-controls { display: flex; align-items: center; gap: 15px; }
    .theme-toggle { background-color: var(--secondary-color); color: white; border: none; border-radius: 20px; padding: 8px 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 500; }
    .user-profile { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px; border-radius: 50px; transition: background-color 0.3s ease; }
    .user-profile:hover { background-color: var(--background-dark); }
    .avatar { width: 45px; height: 45px; border-radius: 50%; background-color: var(--primary-color); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: bold; border: 2px solid var(--primary-light); }
    .main-container { display: flex; flex: 1; }
    .sidebar { width: 280px; background-color: var(--card-bg); box-shadow: var(--shadow); height: calc(100vh - 80px); position: sticky; top: 80px; padding: 25px 0; overflow-y: auto; }
    .welcome-section { padding: 0 25px 25px; border-bottom: 1px solid var(--background-dark); margin-bottom: 20px; }
    .welcome-text { color: var(--text-light); font-size: 0.9rem; margin-bottom: 5px; }
    .username { font-weight: 600; font-size: 1.2rem; color: var(--primary-color); }
    .menu-category { padding: 15px 25px 5px; font-size: 0.85rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
    .menu-item { padding: 12px 25px; display: flex; align-items: center; justify-content: space-between; color: var(--text-color); text-decoration: none; font-weight: 500; border-left: 4px solid transparent; position: relative; }
    .menu-item-content { display: flex; align-items: center; gap: 15px; }
    .menu-item:hover, .menu-item.active { background-color: var(--background-dark); border-left-color: var(--primary-color); color: var(--primary-color); }
    .menu-item i { width: 20px; text-align: center; transition: transform 0.3s ease; }
    @keyframes dance { 0%, 100% { transform: translateY(0) rotate(0); } 25% { transform: translateY(-3px) rotate(-5deg); } 50% { transform: translateY(0) rotate(0); } 75% { transform: translateY(-3px) rotate(5deg); } }
    .menu-item:hover i { animation: dance 0.5s ease infinite; }
    .checkbox-badge { width: 20px; height: 20px; border: 2px solid var(--text-light); border-radius: 5px; display: flex; align-items: center; justify-content: center; position: relative; transition: border-color 0.3s ease, background-color 0.3s ease; }
    .checkbox-badge.checked { border-color: var(--success-color); background-color: var(--success-color); }
    .checkbox-badge.banned { border-color: var(--danger-color); background-color: var(--danger-color); }
    .checkbox-badge.checked::after { content: ''; position: absolute; width: 5px; height: 10px; border: solid white; border-width: 0 3px 3px 0; transform: rotate(45deg); animation: draw-check 0.3s ease forwards; }
    .checkbox-badge.banned::before, .checkbox-badge.banned::after { content: ''; position: absolute; width: 12px; height: 2px; background-color: white; }
    .checkbox-badge.banned::before { transform: rotate(45deg); }
    .checkbox-badge.banned::after { transform: rotate(-45deg); }
    @keyframes draw-check { from { transform: scale(0) rotate(45deg); } to { transform: scale(1) rotate(45deg); } }
    .content { flex: 1; padding: 30px; }
    .page-title { font-size: 1.5rem; margin-bottom: 25px; color: var(--secondary-color); font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .page-title i { color: var(--primary-color); }
    .banner { background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%); border-radius: 12px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 30px; color: white; position: relative; overflow: hidden; }
    .username-display { font-family: 'Dancing Script', cursive; font-size: 1.5rem; color: var(--username-color); font-weight: 700; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); margin: 5px 0; }
    /* ... (tous vos autres styles de cartes, sections, etc. sont ici et restent inchang√©s) ... */
    .footer { background-color: var(--card-bg); padding: 20px 30px; text-align: center; box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08); margin-top: auto; }
    .footer-content { display: flex; flex-direction: column; gap: 10px; }
    .hamburger-menu { display: none; background: none; border: none; font-size: 1.5rem; color: var(--secondary-color); cursor: pointer; }
    .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 98; }
    @media (max-width: 768px) {
      .main-container { flex-direction: column; }
      .hamburger-menu { display: block; }
      .sidebar { width: 70%; max-width: 280px; height: 100vh; position: fixed; top: 0; left: -100%; z-index: 101; box-shadow: 5px 0 15px rgba(0,0,0,0.2); transition: left 0.3s ease-in-out; padding-top: 80px; }
      .sidebar.active { left: 0; }
      .overlay.active { display: block; z-index: 100; }
    }
    .notification-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
    .notification { padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); display: flex; align-items: center; gap: 10px; max-width: 350px; animation: slideIn 0.3s ease forwards; position: relative; overflow: hidden; color: white; pointer-events: auto; }
    .notification.success { background: linear-gradient(135deg, var(--success-color) 0%, #2AB32A 100%); }
    .notification.error { background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%); }
    .notification.info { background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%); }
    @keyframes slideIn { from { transform: translateX(110%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  </style>
</head>
<body>

  <div class="loader-container" id="loader">
    <div class="loader"></div>
  </div>

  <div id="app-wrapper">
    <div class="notification-container" id="notificationContainer"></div>

    <header class="header">
      <button class="hamburger-menu" id="hamburgerMenu"><i class="fas fa-bars"></i></button>
      <div class="logo">MULAFLOWR</div>
      <div class="header-controls">
        <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i><span>Mode nuit</span></button>
        <div class="user-profile" id="userProfile" title="Se d√©connecter">
          <div class="avatar" id="userAvatar">U</div>
        </div>
      </div>
    </header>
    
    <div class="overlay" id="overlay"></div>

    <div class="main-container">
      <aside class="sidebar" id="sidebar">
        <div class="welcome-section">
          <div class="welcome-text">Dashboard >> MULAFLOWR</div>
          <div class="username" id="sidebarUsername">Utilisateur</div>
        </div>
        
        <div class="menu-category">PRINCIPAL</div>
        <a href="dashboard.html" class="menu-item active"><div class="menu-item-content"><i class="fas fa-home"></i><span>Tableau de bord</span></div><span class="checkbox-badge checked"></span></a>
        <a href="depot.html" class="menu-item"><div class="menu-item-content"><i class="fas fa-wallet"></i><span>D√©p√¥t üíµ</span></div><span class="checkbox-badge"></span></a>
        <a href="bonus_bienvenue.html" class="menu-item"><div class="menu-item-content"><i class="fas fa-gift"></i><span>Bonus de bienvenue</span></div><span class="checkbox-badge banned"></span></a>
        
        <div class="menu-category">COMPTES</div>
        <a href="retrait.html" class="menu-item"><div class="menu-item-content"><i class="fas fa-money-bill-wave"></i><span>Retrait</span></div><span class="checkbox-badge"></span></a>
        <a href="equipe.html" class="menu-item"><div class="menu-item-content"><i class="fas fa-users"></i><span>√âquipe</span></div><span class="checkbox-badge banned"></span></a>
      </aside>

      <main class="content">
        <h1 class="page-title"><i class="fas fa-home"></i><span>Dashboard >> MULAFLOWR</span></h1>
        
        <div class="banner" id="welcomeBanner">
          <div class="banner-title">Bienvenue sur MULAFLOWR</div>
          <div class="username-display" id="welcomeUsername">Utilisateur</div>
          <div class="banner-text">D√©bloquez plus de 10 outils num√©riques avec MULAFLOWR, con√ßus pour VOUS !</div>
          <a href="#" class="banner-link">Obtenir l'application Android</a>
        </div>
        
        <div class="small-stats">
          <div class="small-stat-card" id="depense-card"><div class="small-stat-title"><i class="fas fa-arrow-down arrow-icon"></i>D√©pense:</div><div class="small-stat-value">XAF 0</div></div>
          <div class="small-stat-card" id="profit-card"><div class="small-stat-title"><i class="fas fa-arrow-up arrow-icon"></i>Profit:</div><div class="small-stat-value">XAF 0</div></div>
        </div>
        
        <div class="large-stats">
          <div class="large-stat-card" id="solde-card"><div class="large-stat-title"><i class="fas fa-piggy-bank large-stat-icon"></i>SOLDE</div><div class="large-stat-value">XAF 0</div></div>
        </div>
        
        <div class="medium-stats">
          <div class="medium-stat-card" id="retire-card"><div class="medium-stat-title"><i class="fas fa-download medium-stat-icon"></i>Retir√©</div><div class="medium-stat-value">XAF 0</div></div>
          <div class="medium-stat-card" id="parrainage-card"><div class="medium-stat-title"><i class="fas fa-users medium-stat-icon"></i>Gains de parrainage</div><div class="medium-stat-value">XAF 0</div></div>
          <div class="medium-stat-card" id="bonus-agent-card"><div class="medium-stat-title"><i class="fas fa-gift medium-stat-icon"></i>Bonus d'agent</div><div class="medium-stat-value">XAF 0</div></div>
        </div>

        <div class="referral-section">
            <h2 class="section-title">LIEN DE PARRAINAGE</h2>
            <div class="link-box">
                <div class="link-text" id="referralLink">G√©n√©ration...</div>
                <button class="copy-btn" id="copyLinkBtn"><i class="fas fa-copy"></i><span>Copier</span></button>
            </div>
        </div>

        <div class="user-info-section">
            <h2 class="section-title">INFORMATIONS UTILISATEUR</h2>
            <div class="user-info-grid">
                <div class="info-item"><div class="info-label">Nom d'utilisateur</div><div class="info-value" id="info-username">Chargement...</div></div>
                <div class="info-item"><div class="info-label">Email</div><div class="info-value" id="info-email">Chargement...</div></div>
                <div class="info-item"><div class="info-label">T√©l√©phone</div><div class="info-value" id="info-phone">Chargement...</div></div>
                <div class="info-item"><div class="info-label">Pays</div><div class="info-value" id="info-country">Chargement...</div></div>
                <div class="info-item"><div class="info-label">Parrain</div><div class="info-value" id="info-parrain">Chargement...</div></div>
                <div class="info-item"><div class="info-label">Parrainage actif</div><div class="info-value" id="info-parrainage">0 personnes</div></div>
            </div>
        </div>
      </main>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#" class="footer-link">Pro Tech Management</a>
                <a href="#" class="footer-link">Site propuls√© par Social Boost Horizon</a>
            </div>
            <div class="footer-text">¬© 2025 MULAFLOWR. Tous droits r√©serv√©s.</div>
        </div>
    </footer>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC...CeuKP1k", // IMPORTANT: Remplacez par votre cl√© API compl√®te et valide
      authDomain: "cash-flowr.firebaseapp.com",
      projectId: "cash-flowr",
      storageBucket: "cash-flowr.appspot.com",
      messagingSenderId: "1091928501310",
      appId: "1:1091928501310:web:4f4de306cde36f378ff56f",
      measurementId: "G-5SF6VDLZCB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const loader = document.getElementById('loader');
    const appWrapper = document.getElementById('app-wrapper');

    function showNotification(type, title, message, duration = 4000) {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      const icon = type === 'success' ? 'fa-check-circle' : (type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
      notification.innerHTML = `<i class="fas ${icon}" style="font-size: 1.5rem;"></i><div><strong>${title}</strong><br><span>${message}</span></div>`;
      container.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse forwards';
        setTimeout(() => { if (container.contains(notification)) container.removeChild(notification); }, 300);
      }, duration);
    }

    function updateUI(user, userData) {
        const displayName = userData.displayName || user.displayName || user.email.split('@')[0];
        const formatCurrency = (value) => `XAF ${Number(value || 0).toLocaleString('fr-FR')}`;

        document.getElementById('sidebarUsername').textContent = displayName;
        document.getElementById('welcomeUsername').textContent = displayName;
        document.getElementById('userAvatar').textContent = displayName.charAt(0).toUpperCase();

        document.querySelector('#depense-card .small-stat-value').textContent = formatCurrency(userData.depense);
        document.querySelector('#profit-card .small-stat-value').textContent = formatCurrency(userData.profit);
        document.querySelector('#solde-card .large-stat-value').textContent = formatCurrency(userData.solde);
        document.querySelector('#retire-card .medium-stat-value').textContent = formatCurrency(userData.retire);
        document.querySelector('#parrainage-card .medium-stat-value').textContent = formatCurrency(userData.parrainage);
        document.querySelector('#bonus-agent-card .medium-stat-value').textContent = formatCurrency(userData.bonusAgent);
        
        document.getElementById('info-username').textContent = displayName;
        document.getElementById('info-email').textContent = user.email;
        document.getElementById('info-phone').textContent = userData.phoneNumber || 'Non renseign√©';
        document.getElementById('info-country').textContent = userData.country || 'Non renseign√©';
        document.getElementById('info-parrain').textContent = userData.referrer || 'Aucun';
        document.getElementById('info-parrainage').textContent = `${userData.activeReferrals || 0} personnes`;
        
        document.getElementById('referralLink').textContent = `mulaflowr.com/?ref=${user.uid.substring(0, 10)}`;

        const isDarkMode = userData.theme === 'dark';
        document.body.classList.toggle('dark-mode', isDarkMode);
        document.getElementById('themeToggle').innerHTML = isDarkMode 
            ? '<i class="fas fa-sun"></i><span>Mode jour</span>' 
            : '<i class="fas fa-moon"></i><span>Mode nuit</span>';
    }
    
    async function initializeApp(user) {
      try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (!userDoc.exists) { throw new Error("Profil utilisateur introuvable."); }
        const userData = userDoc.data();

        // **V√©rification du paiement** (adaptez `isPaid` au nom de votre champ)
        if (!userData.isPaid) {
          showNotification('info', 'Action requise', 'Veuillez finaliser votre inscription pour continuer.');
          setTimeout(() => { window.location.href = 'paiement.html'; }, 2500);
          return;
        }

        // Mettre √† jour l'interface avec les donn√©es
        updateUI(user, userData);
        
        // Attacher les √©couteurs d'√©v√©nements qui d√©pendent des donn√©es utilisateur
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        hamburgerMenu.addEventListener('click', () => { sidebar.classList.toggle('active'); overlay.classList.toggle('active'); });
        overlay.addEventListener('click', () => { sidebar.classList.remove('active'); overlay.classList.remove('active'); });
        
        document.getElementById('themeToggle').addEventListener('click', () => {
            const isDark = document.body.classList.toggle('dark-mode');
            db.collection('users').doc(user.uid).set({ theme: isDark ? 'dark' : 'light' }, { merge: true });
            document.getElementById('themeToggle').innerHTML = isDark ? '<i class="fas fa-sun"></i><span>Mode jour</span>' : '<i class="fas fa-moon"></i><span>Mode nuit</span>';
        });

        document.getElementById('userProfile').addEventListener('click', () => {
            auth.signOut().then(() => showNotification('info', 'D√©connexion', 'Vous avez √©t√© d√©connect√©.'));
        });
        
        document.getElementById('copyLinkBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(document.getElementById('referralLink').textContent)
              .then(() => showNotification('success', 'Copi√© !', 'Lien de parrainage copi√©.'));
        });

        // Afficher l'application et cacher le loader
        appWrapper.classList.add('loaded');
        loader.classList.add('hidden');
        showNotification('success', `Bienvenue, ${userData.displayName || user.email.split('@')[0]} !`, 'Votre tableau de bord est pr√™t.');

      } catch (error) {
        console.error("Erreur d'initialisation de l'application:", error);
        loader.innerHTML = `
          <div style="text-align: center; color: #c0392b; font-family: 'Poppins', sans-serif; padding: 20px; max-width: 400px;">
            <h3 style="margin-bottom: 15px;">Une erreur est survenue</h3>
            <p>Impossible de charger vos donn√©es. Veuillez rafra√Æchir la page ou contacter le support si le probl√®me persiste.</p>
            <p style="font-size: 0.8em; margin-top: 20px; color: #7f8c8d;">D√©tail : ${error.message}</p>
          </div>`;
      }
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        // L'utilisateur est connect√©, on lance l'application.
        initializeApp(user);
      } else {
        // L'utilisateur n'est pas connect√©, on redirige.
        window.location.href = 'login.html';
      }
    });
  </script>
</body>
</html>
